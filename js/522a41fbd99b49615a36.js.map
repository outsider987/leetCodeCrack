{"version":3,"file":"522a41fbd99b49615a36.js","mappings":"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","sources":["webpack://leetcodecrack/./src/canvas/components/ImageEditor/CanvasImageEditor.tsx","webpack://leetcodecrack/./src/canvas/components/Menu/Menu.tsx","webpack://leetcodecrack/./src/canvas/components/Panel/Brush/BrushPanel.tsx","webpack://leetcodecrack/./src/canvas/components/Panel/Brush/ColorPicker.tsx","webpack://leetcodecrack/./src/canvas/components/Panel/Panel.tsx","webpack://leetcodecrack/./src/pages/Home/Canvas/ImageEditor.tsx","webpack://leetcodecrack/./src/utils/canvas/canvas.ts","webpack://leetcodecrack/./src/utils/canvas/constants.ts","webpack://leetcodecrack/./src/utils/canvas/coordinate.ts","webpack://leetcodecrack/./src/utils/canvas/rect.ts","webpack://leetcodecrack/./src/utils/image.ts"],"sourcesContent":["import React, { useRef, useEffect, useState, useMemo } from 'react';\nimport Views from '~/canvas/ImageEditor/Canvas/Canvas';\nimport Menu from '../Menu/Menu';\nimport { getCurrentZoom } from '~/utils/canvas/canvas';\nimport { LAYOUT_SIZE } from '~/utils/canvas/constants';\nimport { useGlobalContext } from '~/store/context';\nconst CanvasImageEditor = (props) => {\n    const canvasRef = useRef(null);\n    const { MENU_WIDTH, PANEL_WIDTH } = LAYOUT_SIZE;\n    const [file, setFile] = useState(null);\n    const ViewsRef = useRef(new Views());\n    const ContentRef = useRef();\n    const { isShowPanel } = useGlobalContext();\n    const onClickFile = (e) => {\n        setFile(e.target.files[0]);\n    };\n    useEffect(() => {\n        if (!canvasRef.current || !ContentRef.current || file === null)\n            return;\n        ViewsRef.current.initializeCanvas(canvasRef.current);\n        canvasRef.current.width = ContentRef.current.offsetWidth;\n        canvasRef.current.height = ContentRef.current.offsetHeight;\n        ViewsRef.current.loadFile(file);\n        const observer = new ResizeObserver((entries) => {\n            entries.forEach((entry) => {\n                updateDimensions();\n            });\n        });\n        observer.observe(ContentRef.current);\n        return () => {\n            observer.unobserve(ContentRef.current);\n            ViewsRef.current.cleanCanvas();\n        };\n    }, [file]);\n    const contentMaxSize = useMemo(() => {\n        const panelWidth = isShowPanel ? PANEL_WIDTH : 0;\n        return `calc(100% - ${panelWidth || MENU_WIDTH})`;\n    }, [isShowPanel]);\n    const updateDimensions = () => {\n        if (canvasRef.current && file !== null) {\n            // adjust the canvas size to match the size of its container\n            const zoomLevel = getCurrentZoom(ViewsRef.current.ctx);\n            const x = ViewsRef.current.ctx.getTransform().e + ContentRef.current.offsetWidth - canvasRef.current.width;\n            const y = ViewsRef.current.ctx.getTransform().f + ContentRef.current.offsetHeight - canvasRef.current.height;\n            // reset the transform matrix as it is cumulative\n            canvasRef.current.width = ContentRef.current.offsetWidth;\n            canvasRef.current.height = ContentRef.current.offsetHeight;\n            ViewsRef.current.ctx.translate(x, y);\n            ViewsRef.current.ctx.scale(zoomLevel, zoomLevel);\n            ViewsRef.current.draw();\n        }\n    };\n    return (React.createElement(React.Fragment, null,\n        React.createElement(\"div\", { className: `${props.className} h-[100vh] ` },\n            React.createElement(\"div\", { className: \"flex min-w-[2.5rem]\" },\n                React.createElement(Menu, { ViewsRef: ViewsRef, setFile: setFile, file: file })),\n            React.createElement(\"div\", { ref: ContentRef, className: `relative flex-1  border  border-solid border-yellow-400`, style: { maxWidth: contentMaxSize } },\n                file === null && (React.createElement(\"div\", { className: \"absolute inset-0 flex items-center justify-center\" },\n                    React.createElement(\"div\", { className: \" text-white\" }, \"please click or drag file\"),\n                    React.createElement(\"input\", { onChange: onClickFile, className: `absolute inset-0 z-10 cursor-pointer opacity-0 `, type: \"file\", accept: \"image/*\" }))),\n                ContentRef.current && React.createElement(\"canvas\", { ref: canvasRef })))));\n};\nexport default CanvasImageEditor;\n","import React, { useRef, useEffect } from 'react';\nimport { Brush, PanTool as PanIcon, DeleteForever, AutoFixNormal } from '@mui/icons-material';\nimport dynamicClass, { Tools } from '~/canvas/ImageEditor/Tool';\nimport Panel from '../Panel/Panel';\nimport { useGlobalContext } from '~/store/context';\nimport { LAYOUT_SIZE } from '~/utils/canvas/constants';\nconst Menu = ({ ViewsRef, setFile, file }) => {\n    const { mode, setMode, setShowPanel } = useGlobalContext();\n    const ToolRef = useRef(null);\n    const { MENU_WIDTH } = LAYOUT_SIZE;\n    useEffect(() => {\n        if (ViewsRef.current.canvas && file !== null) {\n            setShowPanel(true);\n            const ToolClass = dynamicClass(mode);\n            ToolRef.current = new ToolClass(ViewsRef.current);\n            return () => {\n                ToolRef.current.unRegisterEvent(ViewsRef.current.canvas);\n            };\n        }\n    }, [mode]);\n    const tools = [\n        {\n            icon: React.createElement(Brush, null),\n            onClick: () => setMode(Tools.BrushTool.name),\n        },\n        {\n            icon: React.createElement(PanIcon, null),\n            onClick: () => setMode(Tools.PanTool.name),\n        },\n        {\n            icon: React.createElement(AutoFixNormal, null),\n            onClick: () => setMode(Tools.EraseTool.name),\n        },\n        {\n            icon: React.createElement(DeleteForever, null),\n            onClick: () => setFile(null),\n        },\n    ];\n    return (file && (React.createElement(React.Fragment, null,\n        React.createElement(\"div\", { className: `inset-y-0 left-0 flex min-w-[${MENU_WIDTH}] flex-col  items-center  space-y-3 text-white`, style: { maxWidth: MENU_WIDTH } }, tools.map(({ icon, onClick }, index) => (React.createElement(\"button\", { key: index, onClick: onClick, className: \"cursor-pointer\" }, icon)))),\n        React.createElement(Panel, { title: mode, mode: mode, tool: ToolRef.current, className: \" \" }))));\n};\nexport default Menu;\n","import React, { useRef, useState } from 'react';\nimport CanvasColorPicker from './ColorPicker';\nconst BrushPanel = (props) => {\n    const canvasRef = useRef(null);\n    const [color, setColor] = useState('#000000');\n    const { tool } = props;\n    console.log(tool);\n    return (React.createElement(\"div\", null,\n        React.createElement(CanvasColorPicker, { setColorCallBack: tool.setColor })));\n};\nexport default BrushPanel;\n","import React, { useState } from 'react';\nconst CanvasColorPicker = (props) => {\n    // const canvasRef = useRef(null);\n    // const [selectedColor, setSelectedColor] = useState({ R: 255, G: 255, B: 255, A: 1 });\n    // useEffect(() => {\n    //   const canvas = canvasRef.current;\n    //   const context = canvas.getContext('2d');\n    //   // Draw a gradient on the canvas\n    //   const gradient = context.createLinearGradient(0, 0, 0, canvas.height);\n    //   gradient.addColorStop(0, 'rgba(255, 0, 0, 1)');\n    //   gradient.addColorStop(0.17, 'rgba(255, 255, 0, 1)');\n    //   gradient.addColorStop(0.34, 'rgba(0, 255, 0, 1)');\n    //   gradient.addColorStop(0.51, 'rgba(0, 255, 255, 1)');\n    //   gradient.addColorStop(0.68, 'rgba(0, 0, 255, 1)');\n    //   gradient.addColorStop(0.85, 'rgba(255, 0, 255, 1)');\n    //   gradient.addColorStop(1, 'rgba(255, 0, 0, 1)');\n    //   context.fillStyle = gradient;\n    //   context.fillRect(0, 0, canvas.width, canvas.height);\n    // }, []);\n    // function handlePickerClick(event) {\n    //   const canvas = canvasRef.current;\n    //   const x = event.nativeEvent.offsetX;\n    //   const y = event.nativeEvent.offsetY;\n    //   const imageData = canvas.getContext('2d').getImageData(x, y, 1, 1);\n    //   const color = {\n    //     R: imageData.data[0],\n    //     G: imageData.data[1],\n    //     B: imageData.data[2],\n    //     A: imageData.data[3] / 255,\n    //   };\n    //   setSelectedColor(color);\n    // }\n    // const selectedColorString = `rgba(${selectedColor.R}, ${selectedColor.G}, ${selectedColor.B}, ${selectedColor.A})`;\n    const { setColorCallBack } = props;\n    const [color, setColor] = useState('#000000');\n    const handleColorChange = (event) => {\n        setColor(event.target.value);\n        setColorCallBack(event.target.value);\n        console.log(event.target.value);\n    };\n    return (React.createElement(\"div\", null,\n        React.createElement(\"input\", { type: \"color\", value: color, onChange: handleColorChange })));\n};\nexport default CanvasColorPicker;\n","import { Close } from '@mui/icons-material';\nimport React, { useMemo } from 'react';\nimport { useGlobalContext } from '~/store/context';\nimport BrushPanel from './Brush/BrushPanel';\nimport { LAYOUT_SIZE } from '~/utils/canvas/constants';\nimport BrushTool from '~/canvas/ImageEditor/Tool/Brush';\nimport PanTool from '~/canvas/ImageEditor/Tool/Pan';\nimport EraseTool from '~/canvas/ImageEditor/Tool/Erase';\nconst Panel = (props) => {\n    const { isShowPanel, setShowPanel } = useGlobalContext();\n    const { PANEL_WIDTH } = LAYOUT_SIZE;\n    const { title, children, mode, tool } = props;\n    const panel = useMemo(() => {\n        switch (mode) {\n            case BrushTool.name:\n                return React.createElement(BrushPanel, { tool: tool });\n            case PanTool.name:\n                return React.createElement(React.Fragment, null);\n            case EraseTool.name:\n                return React.createElement(React.Fragment, null);\n            default:\n                return React.createElement(React.Fragment, null);\n        }\n    }, [mode, tool]);\n    return (React.createElement(React.Fragment, null, isShowPanel && (React.createElement(\"div\", { className: `h-full flex-1 flex-col max-w-[${PANEL_WIDTH}]` },\n        React.createElement(\"div\", { ...props, className: `flex  flex-row justify-around bg-navbar p-2` },\n            React.createElement(\"div\", { className: \"flex flex-col items-center space-y-3  border-b border-solid text-white\" }, title),\n            React.createElement(\"div\", null,\n                React.createElement(\"button\", { className: \"flex-1 text-white\", onClick: () => setShowPanel(false) },\n                    React.createElement(Close, null)))),\n        panel))));\n};\nexport default Panel;\n","import React from 'react';\nimport CanvasImageEditor from '~/canvas/components/ImageEditor/CanvasImageEditor';\nconst ImageEditor = () => {\n    return (React.createElement(\"div\", { className: `relative m-auto flex h-full max-h-screen w-full flex-col items-center justify-center` },\n        React.createElement(CanvasImageEditor, { className: \"relative  flex h-full w-full  flex-row border border-solid border-white\" })));\n};\nexport default ImageEditor;\n","export function getCurrentZoom(ctx) {\n    // Extract the current transformation matrix from the context\n    const matrix = ctx.getTransform();\n    // Calculate the current zoom level as the square root of the determinant of the transformation matrix\n    // (see https://developer.mozilla.org/en-US/docs/Web/API/DOMMatrix/determinant)\n    return Math.sqrt(Math.abs(matrix.a * matrix.d - matrix.b * matrix.c));\n}\nexport function redrawBoundBackGround(canvas) {\n    const ctx = canvas.getContext('2d');\n    ctx.save();\n    ctx.setTransform(1, 0, 0, 1, 0, 0);\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\n    ctx.fillStyle = 'grey';\n    ctx.fillRect(0, 0, canvas.width, canvas.height);\n    ctx.restore();\n}\n","export const LAYOUT_SIZE = { MENU_WIDTH: '2.5rem', PANEL_WIDTH: '10rem' };\n","export function getTransformedPoint(e, canvas, ctx) {\n    const { offsetX, offsetY } = e.touches ? e.touches[0] : e;\n    const originalPoint = new DOMPoint(offsetX, offsetY);\n    return ctx.getTransform().invertSelf().transformPoint(originalPoint);\n}\nexport function getTransformedPaintPoint(e, canvas, ctx, scale = 1) {\n    const { offsetX, offsetY } = e.touches ? e.touches[0] : e;\n    const rect = canvas.getBoundingClientRect();\n    console.log(ctx.getTransform());\n    const originalPoint = new DOMPoint(offsetX - rect.left, offsetY, rect.top);\n    return ctx.getTransform().invertSelf().transformPoint(originalPoint);\n}\nexport function getTransformedPoints(e, canvas, ctx) {\n    const { pageX, pageY } = e.touches ? e.touches[0] : e;\n    const rect = canvas.getBoundingClientRect();\n    const originalPoint = new DOMPoint(pageX - rect.left, pageY - rect.top);\n    const point = ctx.getTransform().invertSelf().transformPoint(originalPoint);\n    const x = point.x;\n    const y = point.y;\n    return { x: x, y: y };\n}\n","export function IsInRect(x, y, left, top, right, bottom) {\n    return x >= left && x <= right && y >= top && y <= bottom;\n}\nexport function IsOutRect(x, y, left, top, right, bottom) {\n    return x < left || x > right || y < top || y > bottom;\n}\nexport function IsOverBoundRect(innerLeft, innerTop, innerRight, innerBottom, outerLeft, outerTop, outerRight, outerBottom) {\n    return innerLeft < outerLeft || innerTop < outerTop || innerRight > outerRight || innerBottom > outerBottom;\n}\nexport function getNewSize(canvas, image) {\n    const widthRatio = canvas.width / image.width;\n    const heightRatio = canvas.height / image.height;\n    // Use the smaller ratio to ensure that the image fits inside the canvas\n    const scale = Math.min(widthRatio, heightRatio);\n    // Calculate the new width and height of the image\n    const newWidth = image.width * scale;\n    const newHeight = image.height * scale;\n    return { newWidth, newHeight };\n}\n","export function onload2promise(obj) {\n    return new Promise((resolve, reject) => {\n        obj.onload = () => resolve(obj);\n        obj.onerror = reject;\n    });\n}\n"],"names":[],"sourceRoot":""}