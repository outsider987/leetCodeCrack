{"version":3,"file":"2a1d5d9d1a9ae9e66559.js","mappings":";;;;;;;;;;;;;;;;;;;;AAAoE;AACb;AACvB;AACuB;AACA;AACJ;AACnD;AACA,sBAAsB,6CAAM;AAC5B,YAAY,0BAA0B,EAAE,gEAAW;AACnD,4BAA4B,+CAAQ;AACpC,qBAAqB,6CAAM,KAAK,yEAAK;AACrC,uBAAuB,6CAAM;AAC7B,YAAY,cAAc,EAAE,gEAAgB;AAC5C;AACA;AACA;AACA,IAAI,gDAAS;AACb;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb,SAAS;AACT;AACA;AACA;AACA;AACA;AACA,KAAK;AACL,2BAA2B,8CAAO;AAClC;AACA,8BAA8B,yBAAyB;AACvD,KAAK;AACL;AACA;AACA;AACA,8BAA8B,oEAAc;AAC5C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,YAAY,0DAAmB,CAAC,uDAAc;AAC9C,QAAQ,0DAAmB,UAAU,cAAc,iBAAiB,aAAa;AACjF,YAAY,0DAAmB,UAAU,kCAAkC;AAC3E,gBAAgB,0DAAmB,CAAC,kDAAI,IAAI,kDAAkD;AAC9F,YAAY,0DAAmB,UAAU,gGAAgG,4BAA4B;AACrK,kCAAkC,0DAAmB,UAAU,gEAAgE;AAC/H,oBAAoB,0DAAmB,UAAU,0BAA0B;AAC3E,oBAAoB,0DAAmB,YAAY,sHAAsH;AACzK,sCAAsC,0DAAmB,aAAa,gBAAgB;AACtF;AACA,iEAAe,iBAAiB,EAAC;;;;;;;;;;;;;;;;;;;;;;;;AC9D0B;AACmC;AACzC;AAClB;AACgB;AACnD,gBAAgB,yBAAyB;AACzC,oBAAoB,6CAAM;AAC1B,4BAA4B,+CAAQ;AACpC,YAAY,eAAe,EAAE,gEAAgB;AAC7C;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,IAAI,gDAAS;AACb;AACA;AACA,8BAA8B,oEAAY;AAC1C;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA,QAAQ,0DAAmB,CAAC,2DAAK,IAAI,iBAAiB;AACtD,QAAQ,0DAAmB,CAAC,2DAAO,IAAI,gBAAgB;AACvD,QAAQ,0DAAmB,CAAC,2DAAa,IAAI,kBAAkB;AAC/D,QAAQ,0DAAmB,CAAC,2DAAa,IAAI,uBAAuB;AACpE;AACA,YAAY,0DAAmB,CAAC,uDAAc;AAC9C,QAAQ,0DAAmB,UAAU,6GAA6G,8BAA8B,0DAAmB,UAAU,0CAA0C;AACvP,QAAQ,0DAAmB,CAAC,oDAAK,IAAI,6BAA6B;AAClE;AACA,iEAAe,IAAI,EAAC;;;;;;;;;;;;;;;;;;;ACzCwB;AAClB;AACyB;AACnD;AACA,YAAY,4BAA4B,EAAE,gEAAgB;AAC1D,YAAY,QAAQ;AACpB,YAAY,0DAAmB,CAAC,uDAAc,wBAAwB,0DAAmB,UAAU,wFAAwF;AAC3L,QAAQ,0DAAmB,UAAU,qFAAqF;AAC1H,QAAQ,0DAAmB;AAC3B,YAAY,0DAAmB,aAAa,oEAAoE;AAChH,gBAAgB,0DAAmB,CAAC,2DAAK;AACzC;AACA,iEAAe,KAAK,EAAC;;;;;;;;;;;;;;;;;;ACZK;AACwD;AAClF;AACA,YAAY,0DAAmB,UAAU,+EAA+E;AACxH,QAAQ,0DAAmB,CAAC,wFAAiB,IAAI,2GAA2G;AAC5J;AACA,iEAAe,WAAW,EAAC;;;;;;;;;;;;;;;;ACNpB;AACP;AACA;AACA;AACA;AACA;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;;ACfO,sBAAsB;;;;;;;;;;;;;;;;;ACAtB;AACP,YAAY,mBAAmB;AAC/B;AACA;AACA;AACO;AACP,YAAY,mBAAmB;AAC/B;AACA;AACA;AACA;AACA;AACO;AACP,YAAY,eAAe;AAC3B;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;;;;;;;;;;;;;;;;;;ACpBO;AACP;AACA;AACO;AACP;AACA;AACO;AACP;AACA;AACO;AACP;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAa;AACb;;;;;;;;;;;;;;;AClBO;AACP;AACA;AACA;AACA,KAAK;AACL","sources":["webpack://leetcodecrack/./src/canvas/components/ImageEditor/CanvasImageEditor.tsx","webpack://leetcodecrack/./src/canvas/components/Menu/Menu.tsx","webpack://leetcodecrack/./src/canvas/components/Panel/Panel.tsx","webpack://leetcodecrack/./src/pages/Home/Canvas/ImageEditor.tsx","webpack://leetcodecrack/./src/utils/canvas/canvas.ts","webpack://leetcodecrack/./src/utils/canvas/constants.ts","webpack://leetcodecrack/./src/utils/canvas/coordinate.ts","webpack://leetcodecrack/./src/utils/canvas/rect.ts","webpack://leetcodecrack/./src/utils/image.ts"],"sourcesContent":["import React, { useRef, useEffect, useState, useMemo } from 'react';\nimport Views from '~/canvas/ImageEditor/Canvas/Canvas';\nimport Menu from '../Menu/Menu';\nimport { getCurrentZoom } from '~/utils/canvas/canvas';\nimport { LAYOUT_SIZE } from '~/utils/canvas/constants';\nimport { useGlobalContext } from '~/store/context';\nconst CanvasImageEditor = (props) => {\n    const canvasRef = useRef(null);\n    const { MENU_WIDTH, PANEL_WIDTH } = LAYOUT_SIZE;\n    const [file, setFile] = useState(null);\n    const ViewsRef = useRef(new Views());\n    const ContentRef = useRef();\n    const { isShowPanel } = useGlobalContext();\n    const onClickFile = (e) => {\n        setFile(e.target.files[0]);\n    };\n    useEffect(() => {\n        if (!canvasRef.current || !ContentRef.current || file === null)\n            return;\n        ViewsRef.current.initializeCanvas(canvasRef.current);\n        canvasRef.current.width = ContentRef.current.offsetWidth;\n        canvasRef.current.height = ContentRef.current.offsetHeight;\n        ViewsRef.current.loadFile(file);\n        const observer = new ResizeObserver((entries) => {\n            entries.forEach((entry) => {\n                updateDimensions();\n            });\n        });\n        observer.observe(ContentRef.current);\n        return () => {\n            observer.unobserve(ContentRef.current);\n            ViewsRef.current.cleanCanvas();\n        };\n    }, [file]);\n    const contentMaxSize = useMemo(() => {\n        const panelWidth = isShowPanel ? PANEL_WIDTH : 0;\n        return `calc(100% - ${panelWidth || MENU_WIDTH})`;\n    }, [isShowPanel]);\n    const updateDimensions = () => {\n        if (canvasRef.current && file !== null) {\n            // adjust the canvas size to match the size of its container\n            const zoomLevel = getCurrentZoom(ViewsRef.current.ctx);\n            const x = ViewsRef.current.ctx.getTransform().e + ContentRef.current.offsetWidth - canvasRef.current.width;\n            const y = ViewsRef.current.ctx.getTransform().f + ContentRef.current.offsetHeight - canvasRef.current.height;\n            // reset the transform matrix as it is cumulative\n            canvasRef.current.width = ContentRef.current.offsetWidth;\n            canvasRef.current.height = ContentRef.current.offsetHeight;\n            ViewsRef.current.ctx.translate(x, y);\n            ViewsRef.current.ctx.scale(zoomLevel, zoomLevel);\n            ViewsRef.current.draw();\n        }\n    };\n    return (React.createElement(React.Fragment, null,\n        React.createElement(\"div\", { className: `${props.className} h-[100vh] ` },\n            React.createElement(\"div\", { className: \"flex min-w-[2.5rem]\" },\n                React.createElement(Menu, { ViewsRef: ViewsRef, setFile: setFile, file: file })),\n            React.createElement(\"div\", { ref: ContentRef, className: `relative flex-1  border  border-solid border-yellow-400`, style: { maxWidth: contentMaxSize } },\n                file === null && (React.createElement(\"div\", { className: \"absolute inset-0 flex items-center justify-center\" },\n                    React.createElement(\"div\", { className: \" text-white\" }, \"please click or drag file\"),\n                    React.createElement(\"input\", { onChange: onClickFile, className: `absolute inset-0 z-10 cursor-pointer opacity-0 `, type: \"file\", accept: \"image/*\" }))),\n                ContentRef.current && React.createElement(\"canvas\", { ref: canvasRef })))));\n};\nexport default CanvasImageEditor;\n","import React, { useRef, useEffect, useState } from 'react';\nimport { Brush, PanTool as PanIcon, DeleteForever, AutoFixNormal } from '@mui/icons-material';\nimport dynamicClass from '~/canvas/ImageEditor/Tool';\nimport Panel from '../Panel/Panel';\nimport { useGlobalContext } from '~/store/context';\nconst Menu = ({ ViewsRef, setFile, file }) => {\n    const menuRef = useRef(null);\n    const [mode, setMode] = useState(null);\n    const { setShowPanel } = useGlobalContext();\n    const onDeleteFile = (e) => {\n        setFile(null);\n    };\n    const onDraw = () => {\n        setMode('PaintTool');\n    };\n    const onErase = () => {\n        setMode('EraseTool');\n    };\n    const onPan = () => {\n        setMode('PanTool');\n    };\n    useEffect(() => {\n        if (ViewsRef.current.canvas && file !== null) {\n            setShowPanel(true);\n            const ToolClass = dynamicClass(mode);\n            let tool = new ToolClass(ViewsRef.current);\n            return () => {\n                tool.unRegisterEvent(ViewsRef.current.canvas);\n            };\n        }\n    }, [mode]);\n    const tools = [\n        React.createElement(Brush, { onClick: onDraw }),\n        React.createElement(PanIcon, { onClick: onPan }),\n        React.createElement(AutoFixNormal, { onClick: onErase }),\n        React.createElement(DeleteForever, { onClick: onDeleteFile }),\n    ];\n    return (React.createElement(React.Fragment, null,\n        React.createElement(\"div\", { className: \" inset-y-0 left-0 flex w-menu-width min-w-[2.5rem] flex-col items-center  space-y-3 text-white\" }, tools.map((tool, index) => (React.createElement(\"div\", { className: \" cursor-pointer\", key: index }, tool)))),\n        React.createElement(Panel, { title: mode, className: \" \" })));\n};\nexport default Menu;\n","import { Close } from '@mui/icons-material';\nimport React from 'react';\nimport { useGlobalContext } from '~/store/context';\nconst Panel = (props) => {\n    const { isShowPanel, setShowPanel } = useGlobalContext();\n    const { title } = props;\n    return (React.createElement(React.Fragment, null, isShowPanel && (React.createElement(\"div\", { ...props, className: `flex h-full w-panel-width flex-row justify-around bg-navbar p-2` },\n        React.createElement(\"div\", { className: \"flex flex-col items-center space-y-3  border-b border-solid text-white\" }, title),\n        React.createElement(\"div\", null,\n            React.createElement(\"button\", { className: \"flex-1 text-white\", onClick: () => setShowPanel(false) },\n                React.createElement(Close, null)))))));\n};\nexport default Panel;\n","import React from 'react';\nimport CanvasImageEditor from '~/canvas/components/ImageEditor/CanvasImageEditor';\nconst ImageEditor = () => {\n    return (React.createElement(\"div\", { className: \"relative m-auto flex w-full flex-col items-center justify-center\" },\n        React.createElement(CanvasImageEditor, { className: \"relative  flex h-full w-full max-w-[100vw-(240px)] flex-row border border-solid border-white\" })));\n};\nexport default ImageEditor;\n","export function getCurrentZoom(ctx) {\n    // Extract the current transformation matrix from the context\n    const matrix = ctx.getTransform();\n    // Calculate the current zoom level as the square root of the determinant of the transformation matrix\n    // (see https://developer.mozilla.org/en-US/docs/Web/API/DOMMatrix/determinant)\n    return Math.sqrt(Math.abs(matrix.a * matrix.d - matrix.b * matrix.c));\n}\nexport function redrawBoundBackGround(canvas) {\n    const ctx = canvas.getContext('2d');\n    ctx.save();\n    ctx.setTransform(1, 0, 0, 1, 0, 0);\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\n    ctx.fillStyle = 'grey';\n    ctx.fillRect(0, 0, canvas.width, canvas.height);\n    ctx.restore();\n}\n","export const LAYOUT_SIZE = { MENU_WIDTH: '2.5rem', PANEL_WIDTH: '10rem' };\n","export function getTransformedPoint(e, canvas, ctx) {\n    const { offsetX, offsetY } = e.touches ? e.touches[0] : e;\n    const originalPoint = new DOMPoint(offsetX, offsetY);\n    return ctx.getTransform().invertSelf().transformPoint(originalPoint);\n}\nexport function getTransformedPaintPoint(e, canvas, ctx, scale = 1) {\n    const { offsetX, offsetY } = e.touches ? e.touches[0] : e;\n    const rect = canvas.getBoundingClientRect();\n    console.log(ctx.getTransform());\n    const originalPoint = new DOMPoint(offsetX - rect.left, offsetY, rect.top);\n    return ctx.getTransform().invertSelf().transformPoint(originalPoint);\n}\nexport function getTransformedPoints(e, canvas, ctx) {\n    const { pageX, pageY } = e.touches ? e.touches[0] : e;\n    const rect = canvas.getBoundingClientRect();\n    const originalPoint = new DOMPoint(pageX - rect.left, pageY - rect.top);\n    const point = ctx.getTransform().invertSelf().transformPoint(originalPoint);\n    const x = point.x;\n    const y = point.y;\n    return { x: x, y: y };\n}\n","export function IsInRect(x, y, left, top, right, bottom) {\n    return x >= left && x <= right && y >= top && y <= bottom;\n}\nexport function IsOutRect(x, y, left, top, right, bottom) {\n    return x < left || x > right || y < top || y > bottom;\n}\nexport function IsOverBoundRect(innerLeft, innerTop, innerRight, innerBottom, outerLeft, outerTop, outerRight, outerBottom) {\n    return innerLeft < outerLeft || innerTop < outerTop || innerRight > outerRight || innerBottom > outerBottom;\n}\nexport function getNewSize(canvas, image) {\n    const widthRatio = canvas.width / image.width;\n    const heightRatio = canvas.height / image.height;\n    // Use the smaller ratio to ensure that the image fits inside the canvas\n    const scale = Math.min(widthRatio, heightRatio);\n    // Calculate the new width and height of the image\n    const newWidth = image.width * scale;\n    const newHeight = image.height * scale;\n    return { newWidth, newHeight };\n}\n","export function onload2promise(obj) {\n    return new Promise((resolve, reject) => {\n        obj.onload = () => resolve(obj);\n        obj.onerror = reject;\n    });\n}\n"],"names":[],"sourceRoot":""}